Creating -/- ready CD images
============================

loop mount the image you want to base your custom one on:

  mount -o loop,ro debian-31r0a-i386-netinst.iso /mnt

create a working directory, and copy the contents there, and make the
copy writable:

  
  mkdir d-i-CD
  cp -a /mnt d-i-CD/new
  chmod -R +w d-i-CD/new

and unmount the cd image:

  umount /mnt

Next we need to produce tweaked versions of the initrd files, with the
dashslashdash.udeb

Tweaking initrd
===============

Decompress the initrd.gz of interest:

  zcat d-i-CD/new/install/2.6/initrd.gz > /tmp/initrd-2.6

and/or

  zcat d-i-CD/new/install/initrd.gz > /tmp/initrd-2.4

*********************************************************
*** Then follow the instructions in README-initrd.txt ***
*********************************************************

Now you just compress the initrd you just unmounted:

  gzip < /tmp/initrd-2.6 > d-i-CD/new/install/2.6/initrd.gz
or
  gzip < /tmp/initrd-2.4 > d-i-CD/new/install/initrd.gz

(repeat for the other initrd if you want support for both 2.4 & 2.6 kernels)

--


To save typing, you can add targets to new/isolinux/isolinux.cfg:

=-=-=-=-
LABEL postfix
  kernel /install/vmlinuz
  append vga=normal initrd=/install/initrd.gz ramdisk_size=10240 root=/dev/rd/0 devfs=mount,dall rw -/-=postfix;site-mysite -/url=http://intranet.example.com/d-i --
=-=-=-=-

Also edit d-i-CD/new/isolinux/isolinux.txt, adding something above the boot
prompt so it's clear that you've tweaked the image. I use this, please
come up with your own:

=-=-=-=-
splash.rle

Phil Hands' preseed tweaked netinst --- see http://hands.com/d-i/ for details
add -/-=<class>;... and/or -/url=http://... parameter for an automatic install

Press F1-control ...
=-=-=-=-

Note, that that file contains control characters, and ends without a
newline, so you'll need to edit it with something that will leave that
intact (I use emacs).

Now make the new iso image:

  mkisofs -o d-i-CD/new.iso -r -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table d-i-CD/new
  
and burn it with something like this:

  cdrecord -v speed=16 dev=/dev/cdroms/cdrom0 -eject driveropts=burnproof d-i-CD/new.iso

If you're feeling incredibly lazy (and trusting), here's one I made earlier:

  http://hands.com/d-i/misc/debian-31r0a-i386-netinst-hands-preseed.iso

Once you've got a CD, boot from it, and read http://hands.com/d-i/ for
hints on what to type at the boot prompt to kick things off.

Have Fun!


TODO:

  Make a CD with all the preseed files, all the associated scripts,
  and all the packages that get downloaded, so that you can preseed a
  machine with no NIC -- if anyone does this, please tell me about it.

  It should be easier these days, with the /dashslashdash.sh approach,
  you just need to make it look for the relevant start file in the
  conditional bit near the end (like the /hd-media cases)

Cheers, Phil.
